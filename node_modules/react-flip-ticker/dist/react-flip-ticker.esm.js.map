{"version":3,"file":"react-flip-ticker.esm.js","sources":["../src/index.tsx"],"sourcesContent":["import React, { Fragment, Children, useRef } from \"react\";\n\nconst range = (length: number) => Array.from({ length }, (_, i) => i);\nconst splitText = (text = \"\") => (text + \"\").split(\"\");\nconst numberRange = range(10).map(p => p + \"\");\nconst numAdditional = [\",\", \".\"];\nconst numberItems = [...numberRange, ...numAdditional];\nconst isNumber = (v: string) => !isNaN(parseInt(v, 10));\nconst uniq = (values: string[]) => {\n  return values.filter((value, index) => {\n    return values.indexOf(value) === index;\n  });\n};\n\ntype MeasureMap = { [key: string]: { width: number; height: number } };\n\nconst hiddenPieceStyle: React.CSSProperties = {\n  visibility: \"hidden\",\n};\n\nconst tickStyle: React.CSSProperties = {\n  overflow: \"hidden\",\n  display: \"inline-block\",\n  position: \"relative\",\n};\n\nconst rotatorStyle: React.CSSProperties = {\n  position: \"absolute\",\n  left: \"0\",\n  top: \"0\",\n  bottom: \"0\",\n  right: \"0\",\n};\n\nconst pieceStyle: React.CSSProperties = {\n  position: \"absolute\",\n  left: \"0\",\n  zIndex: 10,\n};\n\ninterface TickProps {\n  children: string;\n  rotateItems: string[];\n  className: string;\n  currentClassName: string;\n  hiddenClassName: string;\n  duration: string;\n  measureMap: MeasureMap;\n}\n\nexport const Tick: React.FC<{\n  children: string;\n  rotateItems: string[];\n}> = props => {\n  //@ts-ignore\n  return <InternalTick {...props} />;\n};\n\nconst InternalTick: React.FC<TickProps> = ({\n  children,\n  measureMap,\n  rotateItems,\n  className,\n  currentClassName,\n  hiddenClassName,\n  duration,\n}) => {\n  const index = rotateItems.indexOf(children);\n  const { height, width } = measureMap[children];\n\n  return (\n    <span className={className} style={{ ...tickStyle, width: `${width}px` }}>\n      <span className={className} style={hiddenPieceStyle}>\n        {children}\n      </span>\n      <span\n        style={{\n          ...rotatorStyle,\n          transition: `transform ${duration}`,\n          transform: `translateY(${height * index * -1}px)`,\n        }}\n      >\n        {rotateItems.map((value, i) => {\n          return (\n            <span\n              key={value + i}\n              className={[\n                className,\n                value === children ? currentClassName : hiddenClassName,\n              ].join(\" \")}\n              style={{ ...pieceStyle, top: i * height }}\n            >\n              {value}\n            </span>\n          );\n        })}\n      </span>\n    </span>\n  );\n};\n\nconst measure = (\n  className: string,\n  value: string,\n): { width: number; height: number } => {\n  const d = document.createElement(\"span\");\n  d.textContent = value;\n  d.className = className;\n  d.style.opacity = \"0\";\n  d.style.pointerEvents = \"none\";\n  d.style.position = \"absolute\";\n  document.body.appendChild(d);\n  const height = d.offsetHeight;\n  const width = d.offsetWidth;\n  document.body.removeChild(d);\n  return {\n    height,\n    width,\n  };\n};\n\ninterface Props {\n  children: React.ReactNode;\n  currentClassName?: string;\n  hiddenClassName?: string;\n  textClassName: string;\n  duration?: string;\n}\n\nexport const Ticker: React.FC<Props> = ({\n  children,\n  textClassName,\n  currentClassName = \"currentTicker\",\n  hiddenClassName = \"hiddenTicker\",\n  duration = \".5s\",\n}) => {\n  const measureMap = useRef<MeasureMap>({});\n  const measureStrings: string[] = Children.map(children, child => {\n    if (typeof child === \"string\" || typeof child === \"number\") {\n      return splitText(`${child}`);\n    } else {\n      //@ts-ignore\n      return child.props && child.props.rotateItems;\n    }\n  }).flat();\n\n  const hasNumbers = measureStrings.find(v => isNumber(v)) !== undefined;\n  const rotateItems = uniq([\n    ...(hasNumbers ? numberItems : []),\n    ...measureStrings,\n  ]);\n\n  if (Object.keys(measureMap.current).length !== rotateItems.length) {\n    rotateItems.forEach(item => {\n      measureMap.current[item] = measure(textClassName, item);\n    });\n  }\n\n  return (\n    <Fragment>\n      {Children.map(children, child => {\n        if (typeof child === \"string\" || typeof child === \"number\") {\n          return splitText(`${child}`).map((text, index) => {\n            let items = isNumber(text) ? numberItems : [text];\n            return (\n              <InternalTick\n                key={index}\n                duration={duration}\n                currentClassName={currentClassName}\n                hiddenClassName={hiddenClassName}\n                className={textClassName}\n                rotateItems={items}\n                measureMap={measureMap.current}\n              >\n                {text}\n              </InternalTick>\n            );\n          });\n        } else {\n          //@ts-ignore\n          return React.cloneElement(child, {\n            duration,\n            className: textClassName,\n            measureMap: measureMap.current,\n            currentClassName: currentClassName,\n            hiddenClassName: hiddenClassName,\n          });\n        }\n      })}\n    </Fragment>\n  );\n};\n"],"names":["range","length","Array","from","_","i","splitText","text","split","numberRange","map","p","numAdditional","numberItems","isNumber","v","isNaN","parseInt","uniq","values","filter","value","index","indexOf","hiddenPieceStyle","visibility","tickStyle","overflow","display","position","rotatorStyle","left","top","bottom","right","pieceStyle","zIndex","Tick","props","React","InternalTick","children","measureMap","rotateItems","className","currentClassName","hiddenClassName","duration","height","width","style","transition","transform","key","join","measure","d","document","createElement","textContent","opacity","pointerEvents","body","appendChild","offsetHeight","offsetWidth","removeChild","Ticker","textClassName","useRef","measureStrings","Children","child","flat","hasNumbers","find","undefined","Object","keys","current","forEach","item","Fragment","items","cloneElement"],"mappings":"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"}